(()=>{var e={951:(e,r,t)=>{function n(e,r,t,n,o,a,s){try{var i=e[a](s),u=i.value}catch(e){return void t(e)}i.done?r(u):Promise.resolve(u).then(n,o)}function o(e){return function(){var r=this,t=arguments;return new Promise((function(o,a){var s=e.apply(r,t);function i(e){n(s,o,a,i,u,"next",e)}function u(e){n(s,o,a,i,u,"throw",e)}i(void 0)}))}}function a(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=t(177),i=(s.getLogger(),s.getLogger("apisError"));t(754);var u=t(574),c=function(){function e(){!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e)}var r,t,n,s,c;return r=e,t=[{key:"save",value:(c=o(regeneratorRuntime.mark((function e(r){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=new u({author:{id:r.email,name:r.name,lastname:r.lastname,age:r.age,alias:r.alias,avatar:r.avatar},date:r.date,message:r.message}),e.next=4,t.save();case 4:return e.abrupt("return",console.log("File saved successfully"));case 7:e.prev=7,e.t0=e.catch(0),i.error("The file cannot be written.");case 10:case"end":return e.stop()}}),e,null,[[0,7]])}))),function(e){return c.apply(this,arguments)})},{key:"getAll",value:(s=o(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.find();case 3:if(!(r=e.sent)){e.next=6;break}return e.abrupt("return",r);case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),i.error("The file cannot be read.");case 11:case"end":return e.stop()}}),e,null,[[0,8]])}))),function(){return s.apply(this,arguments)})},{key:"deleteAll",value:(n=o(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.deleteMany();case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),i.error("The file cannot be read.");case 8:case"end":return e.stop()}}),e,null,[[0,5]])}))),function(){return n.apply(this,arguments)})}],t&&a(r.prototype,t),Object.defineProperty(r,"prototype",{writable:!1}),e}();e.exports=c},402:(e,r,t)=>{function n(e,r,t,n,o,a,s){try{var i=e[a](s),u=i.value}catch(e){return void t(e)}i.done?r(u):Promise.resolve(u).then(n,o)}function o(e){return function(){var r=this,t=arguments;return new Promise((function(o,a){var s=e.apply(r,t);function i(e){n(s,o,a,i,u,"next",e)}function u(e){n(s,o,a,i,u,"throw",e)}i(void 0)}))}}function a(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=t(595),i=function(){function e(r){!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e),this.products={},this.path=r}var r,t,n,i,u,c,p;return r=e,t=[{key:"save",value:(p=o(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.writeProduct(r);case 2:case"end":return e.stop()}}),e)}))),function(e){return p.apply(this,arguments)})},{key:"editById",value:(c=o(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.reWriteProduct(r);case 2:case"end":return e.stop()}}),e)}))),function(e){return c.apply(this,arguments)})},{key:"getById",value:(u=o(regeneratorRuntime.mark((function e(r){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.readProduct(this.path);case 2:if(!(t=e.sent)){e.next=8;break}if(!(n=t.find((function(e){return e.id==r})))){e.next=7;break}return e.abrupt("return",n);case 7:return e.abrupt("return",null);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"getAll",value:(i=o(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.readProduct(this.path);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"deleteById",value:(n=o(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.deleteProduct(r);case 2:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})}],t&&a(r.prototype,t),Object.defineProperty(r,"prototype",{writable:!1}),e}();e.exports=i},91:e=>{e.exports=function(e,r,t){if(e.isAuthenticated())return t();r.redirect("/login")}},962:e=>{e.exports={mongoDb:{cnxUrl:process.env.MONGO_URL,secret:process.env.MONGO_SECRET},mysql:{client:process.env.MYSQL_CLIENT,host:process.env.MYSQL_HOST,port:process.env.MYSQL_PORT,user:process.env.MYSQL_USER,pass:process.env.MYSQL_PASS,database:process.env.MYSQL_DATABASE}}},754:(e,r,t)=>{var n=t(962),o=t(177).getLogger(),a=t(514)({client:n.mysql.client,connection:{host:n.mysql.host,port:n.mysql.port,user:n.mysql.user,password:n.mysql.pass,database:n.mysql.database},pool:{min:2,max:8}});a.schema.hasTable("products").then((function(e){if(!e)return a.schema.createTable("products",(function(e){e.increments("id").primary(),e.string("title",70),e.integer("price").notNullable(),e.string("thumbnail",128)}))})),t(185).connect(n.mongoDb.cnxUrl,{serverSelectionTimeoutMS:5e3}).then((function(){return o.info("Database Connected")})).catch((function(){return o.error("Failed to connect to Database")})),e.exports=a},595:(e,r,t)=>{function n(e,r,t,n,o,a,s){try{var i=e[a](s),u=i.value}catch(e){return void t(e)}i.done?r(u):Promise.resolve(u).then(n,o)}function o(e){return function(){var r=this,t=arguments;return new Promise((function(o,a){var s=e.apply(r,t);function i(e){n(s,o,a,i,u,"next",e)}function u(e){n(s,o,a,i,u,"throw",e)}i(void 0)}))}}var a=t(177),s=a.getLogger(),i=a.getLogger("apisError"),u=t(754),c=function(){var e=o(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u("products").insert(r).then((function(e){return s.info("File saved successfully")})).catch((function(e){return i.error("The file cannot be written.")}));case 2:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),p=function(){var e=o(regeneratorRuntime.mark((function e(r){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.from(r).then((function(e){return JSON.parse(JSON.stringify(e))})).catch((function(e){return i.error("The file cannot be read.")}));case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),l=function(){var e=o(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u("products").where({id:r}).del();case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),i.error(e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(r){return e.apply(this,arguments)}}(),f=function(){var e=o(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u("products").where({id:r.id}).update({title:r.title,price:r.price,thumbnail:r.thumbnail});case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),i.error(e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(r){return e.apply(this,arguments)}}();e.exports={readProduct:p,writeProduct:c,deleteProduct:l,reWriteProduct:f}},177:(e,r,t)=>{var n=t(94);n.configure({appenders:{loggerConsole:{type:"console"},loggerWarm:{type:"file",filename:"warn.log"},loggerError:{type:"file",filename:"error.log"}},categories:{default:{appenders:["loggerConsole"],level:"info"},routeNotExist:{appenders:["loggerWarm"],level:"warn"},apisError:{appenders:["loggerError"],level:"error"}}}),e.exports=n},700:(e,r,t)=>{var n=t(481);e.exports=function(){for(var e=[],r=0;r<5;r++)e.push({title:n.commerce.productName(),price:n.commerce.price(),picture:n.image.fashion()});return e}},574:(e,r,t)=>{var n=t(185),o=n.Schema,a=n.model,s=new o({author:{id:{type:String,required:!0},name:{type:String,required:!0},lastname:{type:String,required:!0},age:{type:Number,required:!0,min:18},alias:{type:String,required:!0},avatar:{type:String,required:!0}},date:{type:String,required:!0},message:{type:String,required:!0}});e.exports=a("chat",s)},886:(e,r,t)=>{var n=t(185),o=n.Schema,a=n.model,s=new o({username:{type:String,required:!0},password:{type:String,required:!0}});e.exports=a("user",s)},537:(e,r,t)=>{var n=t(202),o=n.normalize,a=n.denormalize,s=n.schema,i=t(837),u=new s.Entity("author",{},{idAttribute:"id"}),c=new s.Entity("message",{author:u}),p=new s.Entity("messages",{author:u,messages:[c]});e.exports={chatSchema:p,normalize:o,denormalize:a,print:function(e){console.log(i.inspect(e,!1,12,!0))}}},148:(e,r,t)=>{function n(e,r,t,n,o,a,s){try{var i=e[a](s),u=i.value}catch(e){return void t(e)}i.done?r(u):Promise.resolve(u).then(n,o)}function o(e){return function(){var r=this,t=arguments;return new Promise((function(o,a){var s=e.apply(r,t);function i(e){n(s,o,a,i,u,"next",e)}function u(e){n(s,o,a,i,u,"throw",e)}i(void 0)}))}}var a=t(511),s=t(55).Strategy,i=t(177).getLogger();t(754);var u=t(886);a.use("local-login",new s(function(){var e=o(regeneratorRuntime.mark((function e(r,t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.findOne({username:r,password:t},(function(e,r){return e?n(e):r?n(null,r):(i.warn("User not found."),n(null,!1))})).clone();case 2:case"end":return e.stop()}}),e)})));return function(r,t,n){return e.apply(this,arguments)}}())),a.use("local-signup",new s({usernameField:"username",passwordField:"password",passReqToCallback:!0},function(){var e=o(regeneratorRuntime.mark((function e(r,t,n,o){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.findOne({username:t,password:n});case 2:if(!e.sent){e.next=6;break}return i.warn("User already exists."),e.abrupt("return",o(null,!1));case 6:return a=new u({username:t,password:n}),e.next=9,a.save();case 9:return e.abrupt("return",o(null,a));case 10:case"end":return e.stop()}}),e)})));return function(r,t,n,o){return e.apply(this,arguments)}}())),a.serializeUser((function(e,r){r(null,e._id)})),a.deserializeUser((function(e,r){u.findById(e,r)})),e.exports=a},84:(e,r,t)=>{var n=new(0,t(860).Router),o=t(148),a=t(177).getLogger("routeNotExist");n.post("/signup",o.authenticate("local-signup",{successRedirect:"/login",failureRedirect:"/failSignup"})),n.post("/login",o.authenticate("local-login",{successRedirect:"/home",failureRedirect:"/failLogin"})),n.get("/",(function(e,r){try{r.render("pages/signup")}catch(e){a.warn(e)}})),n.get("/login",(function(e,r){try{r.render("pages/login")}catch(e){a.warn(e)}})),n.get("/failLogin",(function(e,r){try{r.render("pages/failLogin")}catch(e){a.warn(e)}})),n.get("/failSignup",(function(e,r){try{r.render("pages/failSignup")}catch(e){a.warn(e)}})),n.post("/logout",(function(e,r){try{nameUser=e.user.username,e.logout(),r.render("pages/logout",{nameUser})}catch(e){a.warn(e)}})),e.exports=n},748:(e,r,t)=>{var n=t(91),o=new(0,t(860).Router),a=t(177).getLogger("routeNotExist");o.get("/home",n,(function(e,r){try{r.render("pages/home",{nameUser:e.user.username,title:"List of products"})}catch(e){a.warn(e)}})),e.exports=o},245:(e,r,t)=>{var n=new(0,t(860).Router),o=t(37).cpus().length,a=t(177).getLogger("routeNotExist"),s=t(455);n.use(s()),n.get("/",(function(e,r){try{r.send("<pre>"+JSON.stringify({Numero_procesadores_en_servidor:o,Argumentos_de_entrada:process.argv.slice(2),Nombre_plataforma:process.platform,Version_Node:process.version,Memoria_RSS:process.memoryUsage.rss(),Path_ejecucion:process.execPath,Process_id:process.pid,Carpeta_proyecto:process.cwd()},null,2)+"</pre>")}catch(e){a.warn(e)}})),e.exports=n},875:(e,r,t)=>{var n=new(0,t(860).Router),o=new(t(402))("products"),a=t(700),s=t(91),i=t(177),u=i.getLogger("apisError"),c=i.getLogger();n.get("/:id",s,(function(e,r){try{var t=parseInt(e.params.id);o.getById(t).then((function(e){try{if(e)return void r.render("pages/product",{title:"Product Detail",data:e});r.json({Error:"Product not found"})}catch(e){c.error("Product not found"),c.error(e)}}))}catch(e){u.warn(e)}})),n.delete("/:id",s,(function(e,r){try{var t=parseInt(e.params.id);o.deleteById(t)}catch(e){u.warn(e)}})),n.get("/edit/:id",s,(function(e,r){try{var t=parseInt(e.params.id);o.getById(t).then((function(e){r.render("pages/editProduct",{title:" Edit Product",data:e})})).catch((function(e){r.json({Error:"Product not found"})}))}catch(e){u.warn(e)}})),n.get("/api/products-test",s,(function(e,r){try{r.send(a())}catch(e){u.warn(e)}})),e.exports=n},795:(e,r,t)=>{var n=new(0,t(860).Router),o=(t(81).fork,t(177).getLogger("apisError"));n.get("/",(function(e,r){try{var t=function(e){for(var r=[],t=0;t<e;t++){var n=Math.floor(1e3*Math.random())+1;r.push(n)}var o={};return r.forEach((function(e){o[e]=(o[e]||0)+1})),o}(e.query.cant||"100000000");r.send("<pre>".concat(JSON.stringify(t,null,2),"</pre>"))}catch(e){o.warn(e)}})),e.exports=n},478:e=>{"use strict";e.exports=require("babel-polyfill")},455:e=>{"use strict";e.exports=require("compression")},730:e=>{"use strict";e.exports=require("connect-mongo")},582:e=>{"use strict";e.exports=require("cors")},142:e=>{"use strict";e.exports=require("dotenv")},860:e=>{"use strict";e.exports=require("express")},508:e=>{"use strict";e.exports=require("express-session")},481:e=>{"use strict";e.exports=require("faker")},514:e=>{"use strict";e.exports=require("knex")},94:e=>{"use strict";e.exports=require("log4js")},566:e=>{"use strict";e.exports=require("minimist")},185:e=>{"use strict";e.exports=require("mongoose")},202:e=>{"use strict";e.exports=require("normalizr")},511:e=>{"use strict";e.exports=require("passport")},55:e=>{"use strict";e.exports=require("passport-local")},952:e=>{"use strict";e.exports=require("socket.io")},81:e=>{"use strict";e.exports=require("child_process")},1:e=>{"use strict";e.exports=require("cluster")},685:e=>{"use strict";e.exports=require("http")},37:e=>{"use strict";e.exports=require("os")},837:e=>{"use strict";e.exports=require("util")}},r={};function t(n){var o=r[n];if(void 0!==o)return o.exports;var a=r[n]={exports:{}};return e[n](a,a.exports,t),a.exports}(()=>{function e(e,r,t,n,o,a,s){try{var i=e[a](s),u=i.value}catch(e){return void t(e)}i.done?r(u):Promise.resolve(u).then(n,o)}function r(r){return function(){var t=this,n=arguments;return new Promise((function(o,a){var s=r.apply(t,n);function i(r){e(s,o,a,i,u,"next",r)}function u(r){e(s,o,a,i,u,"throw",r)}i(void 0)}))}}t(478);var n=t(582),o=t(860),a=t(1),s=t(37).cpus().length;t(142).config();var i=t(962),u=t(566),c=t(177),p=c.getLogger(),l=c.getLogger("routeNotExist"),f=t(508),d=t(730),g=t(511),m=t(84),v=t(748),h=t(875),x=t(245),w=t(795),y=new(t(402))("products"),R=new(t(951)),b=u(process.argv.slice(2),{default:{PORT:8080,SERVER:"FORK"}}),k=b.PORT,S=b.SERVER,P=t(685);if(a.isPrimary&&"CLUSTER"===S){for(var q=0;q<s;q++)a.fork();a.on("exit",(function(e,r,t){p.info("Worker ".concat(e.process.pid," died."))}))}else{var E=o(),L=P.createServer(E);E.use(n()),E.set("views","./views"),E.set("view engine","ejs"),E.use(o.json()),E.use(o.urlencoded({extended:!0})),E.use(o.static(process.cwd()+"/public")),E.use(f({store:d.create({mongoUrl:i.mongoDb.cnxUrl,mongoOptions:{useNewUrlParser:!0,useUnifiedTopology:!0}}),secret:i.mongoDb.secret,resave:!0,saveUninitialized:!0,rolling:!0,cookie:{maxAge:6e5}})),E.use(g.initialize()),E.use(g.session()),8081==k&&"CLUSTER"===S&&E.use("/api/randoms",w),E.use("/api/randoms",w),E.use("/info",x),E.use("/",m),E.use(v),E.use(h),E.use((function(e,r,t){l.warn("Quisieron ingresar a ".concat(e.path)),r.status(404).send("Route not found!")})),L.listen(k,(function(){p.info("Servidor http escuchando en el puerto: ".concat(L.address().port))})),L.on("error",(function(e){return p.error("Error en servidor: ".concat(e))}));var T=t(537),U=T.chatSchema,_=T.normalize,O=(T.denormalize,T.print,t(952)(L));O.on("connection",(function(e){p.info("Client Conected"),y.getAll().then((function(e){return O.sockets.emit("productsList",e)})),e.on("addProduct",function(){var e=r(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.save(r);case 2:y.getAll().then((function(e){return O.sockets.emit("productsList",e)}));case 3:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()),e.on("editProduct",function(){var e=r(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.editById(r);case 2:y.getAll().then((function(e){return O.sockets.emit("productsList",e)}));case 3:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()),e.on("deleteProduct",function(){var e=r(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:y.getAll().then((function(e){return O.sockets.emit("productsList",e)}));case 1:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()),R.getAll().then((function(e){if(e.length>0)return O.sockets.emit("chat",e)})),e.on("msn",function(){var e=r(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R.save(r);case 2:return O.sockets.emit("email",r.email),e.next=5,R.getAll().then((function(e){if(_({id:"messages",messages:e},U),e.length>0)return O.sockets.emit("chat",e)}));case 5:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()),e.on("disconnect",(function(){R.deleteAll(),p.info("User disconnected")}))}))}})()})();